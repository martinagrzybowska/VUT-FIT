-- Authors: xhandz00, xgrzyb00
-- IDS 2016/2017, SQL skript 1
-- Cech zlodejov

--------------------------------------
----------   DROP TABLES    ----------

DROP TABLE zlodej CASCADE CONSTRAINT;
DROP TABLE rajon CASCADE CONSTRAINT;
DROP TABLE vybavenie CASCADE CONSTRAINT;
DROP TABLE povolenie CASCADE CONSTRAINT;
DROP TABLE zlocin CASCADE CONSTRAINT;

DROP TABLE vyuzite_na CASCADE CONSTRAINT;
DROP TABLE pohybuje_sa_v CASCADE CONSTRAINT;
DROP TABLE vlastnil CASCADE CONSTRAINT;

DROP TABLE oblecenie CASCADE CONSTRAINT;
DROP TABLE zbran CASCADE CONSTRAINT;
DROP TABLE nastroj CASCADE CONSTRAINT;

--------------------------------------
--------    CREATE TABLES    ---------

CREATE TABLE zlodej(
	rodne_cislo NUMBER PRIMARY KEY,
	meno VARCHAR(20),
	prezyvka VARCHAR(50) NOT NULL,
	datum_narodenia DATE NOT NULL,
	odmena_za_dolapenie NUMBER NOT NULL,
	stav VARCHAR(10) NOT NULL,
	specializacia VARCHAR(50) NOT NULL,

	CHECK (odmena_za_dolapenie >= 0)
);

CREATE TABLE rajon(
	ID_rajon NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	pocet_obyvatelov INTEGER NOT NULL,
	celkove_bohatstvo NUMBER NOT NULL,
	kapacita_zlodejov INTEGER NOT NULL,

	CHECK (pocet_obyvatelov >= 0),
	CHECK (kapacita_zlodejov >= 0)
);

CREATE TABLE zlocin(
	ID_zlocin NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	hodnota_koristi NUMBER NOT NULL,
	datum_prevedenia DATE NOT NULL,
	miera_obtiaznosti NUMBER(2,0) NOT NULL,
	detail_zlocinu VARCHAR(50),
	ID_rajon NUMBER NOT NULL, --FOREIGN
	
	CHECK (miera_obtiaznosti >= 0 AND miera_obtiaznosti <= 10)
);

CREATE TABLE povolenie(
	ID_povolenie NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	detail_povolenia VARCHAR(50),
	typ_zlocinu VARCHAR(50) NOT NULL,
	pomer_koristi NUMBER(3,2) NOT NULL,
	ID_zlocin NUMBER, --FOREIGN
	rodne_cislo NUMBER NOT NULL, --FOREIGN
	
	CHECK (pomer_koristi > 0 AND pomer_koristi <= 1)
);

CREATE TABLE vyuzite_na(
	ID_vybavenie NUMBER NOT NULL, --FOREIGN
	ID_zlocin NUMBER NOT NULL --FOREIGN
);

CREATE TABLE pohybuje_sa_v(
	ID_rajon NUMBER NOT NULL, --FOREIGN
	rodne_cislo NUMBER NOT NULL --FOREIGN
);

CREATE TABLE vlastnil(
	ID_vybavenie NUMBER NOT NULL, --FOREIGN
	rodne_cislo NUMBER NOT NULL, --FOREIGN
	od DATE NOT NULL,
	do DATE,

	CHECK (od <= do)
);

CREATE TABLE vybavenie(
	ID_vybavenie NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	detail_vybavenia VARCHAR(50),
	datum_vyroby DATE,
	cena_na_trhu NUMBER,
	material VARCHAR(50) NOT NULL
);

CREATE TABLE oblecenie(
	ID_vybavenie NUMBER PRIMARY KEY, 
	typ_oblecenia VARCHAR(50) NOT NULL,
	specialna_vlastnost VARCHAR(50) NOT NULL,
	miera_odolnosti NUMBER(2,0),
	farba VARCHAR(20),

	CHECK (miera_odolnosti >= 0 AND miera_odolnosti <= 10)
);

CREATE TABLE zbran(
	ID_vybavenie NUMBER PRIMARY KEY, 
	druh_zbrane VARCHAR(20) NOT NULL,
	nazov VARCHAR(20),
	miera_hrozby NUMBER(2,0) NOT NULL,
	hmotnost NUMBER,

	CHECK (miera_hrozby >= 0 AND miera_hrozby <= 10)
);

CREATE TABLE nastroj(
	ID_vybavenie NUMBER PRIMARY KEY,
	typ_nastroja VARCHAR(20) NOT NULL,
	vyuzitie VARCHAR(20) NOT NULL,
	velkost VARCHAR(20)
);

--------------------------------------
-----------    SET KEYS    -----------

-- COMPOSITE KEYS
ALTER TABLE vyuzite_na ADD CONSTRAINT pk_vyuzite_na PRIMARY KEY (ID_vybavenie, ID_zlocin);
ALTER TABLE pohybuje_sa_v ADD CONSTRAINT pk_pohybuje_sa_v PRIMARY KEY (ID_rajon, rodne_cislo);
ALTER TABLE vlastnil ADD CONSTRAINT pk_vlastnil PRIMARY KEY (ID_vybavenie, rodne_cislo);

--FOREIGN
ALTER TABLE zlocin ADD CONSTRAINT fk_ID_rajon FOREIGN KEY (ID_rajon) REFERENCES rajon(ID_rajon);
ALTER TABLE povolenie ADD CONSTRAINT fk_ID_zlocin FOREIGN KEY (ID_zlocin) REFERENCES zlocin(ID_zlocin);
ALTER TABLE povolenie ADD CONSTRAINT fk_rodne_cislo FOREIGN KEY (rodne_cislo) REFERENCES zlodej(rodne_cislo);
ALTER TABLE oblecenie ADD CONSTRAINT fk_ID_vybavenie_1 FOREIGN KEY (ID_vybavenie) REFERENCES vybavenie(ID_vybavenie);
ALTER TABLE zbran ADD CONSTRAINT fk_ID_vybavenie_2 FOREIGN KEY (ID_vybavenie) REFERENCES vybavenie(ID_vybavenie);
ALTER TABLE nastroj ADD CONSTRAINT fk_ID_vybavenie_3 FOREIGN KEY (ID_vybavenie) REFERENCES vybavenie(ID_vybavenie);

--------------------------------------
---------    FILL TABLES    ----------

----- ZLODEJ /rod.c, meno, prezyvka, narodenie, odmena, stav, spec
INSERT INTO zlodej VALUES('9262247712','Juraj Janosik', 'Durko', '01.01.1970', '900', 'zivy', 'pocestny lupic');
INSERT INTO zlodej VALUES('7403099863','Daniel Danko', 'Kapitan Danko', '09.03.1974', '999999', 'zivy', 'politik s hlbokym vreckom');
INSERT INTO zlodej VALUES('8762147612','James Moriarty', 'Consulting criminal', '02.01.1975', '90000', 'zivy', 'terorista');

----- RAJON /id, pocet ob, bohatstvo, kapacit
INSERT INTO rajon VALUES('000', '800', '20000', '40'); 
INSERT INTO rajon VALUES('001', '900', '42000', '30');
INSERT INTO rajon VALUES('002', '9000', '50000', '100');

----- VYBAVENIE /id, detail, datum, cena, material
----- nastroj typ, vyuzitie, velkost
INSERT INTO vybavenie VALUES('100', 'krasny', NULL, NULL, 'raketove palivo');
INSERT INTO nastroj VALUES('100', 'vybusnina', 'pohon', NULL);

----- zbran / id, druh, nazov, miera, hmotnost
INSERT INTO vybavenie VALUES('101', NULL, '20.4.2012', '8000', 'zelezo');
INSERT INTO zbran VALUES('101', 'sekerka', 'krkolam', '0,3', NULL);

------ oblecenie / typ, specialita, odolnost, darba
INSERT INTO vybavenie VALUES('102', NULL, NULL, '9000', 'koza');
INSERT INTO oblecenie VALUES('102', 'spodna bielizen', 'nepriestrelna', '7', 'ruzova');

------ VLASTNIL / rodne cislo, id vybavenie, od, do
INSERT INTO vlastnil VALUES('9262247712','100', '20.4.1998', '20.5.1998');
INSERT INTO vlastnil VALUES('9262247712','101', '20.5.1999', NULL);
INSERT INTO vlastnil VALUES('7403099863','102', '20.6.1997', NULL);

------ POHYBUJE SA V / id rajon, rodne cislo
INSERT INTO pohybuje_sa_v VALUES('000', '9262247712');
INSERT INTO pohybuje_sa_v VALUES('001', '7403099863');
INSERT INTO pohybuje_sa_v VALUES('000', '8762147612');
INSERT INTO pohybuje_sa_v VALUES('002', '7403099863');
INSERT INTO pohybuje_sa_v VALUES('002', '8762147612');

------ ZLOCIN / id, hodnota, datum, obtiaznost, detail, id rajon 
INSERT INTO zlocin VALUES('1', '2000', '12.10.2010','4', 'vydaril sa', '000');
INSERT INTO zlocin VALUES('2', '2000', '12.10.2010','4', NULL, '001');

------ POVOLENIE / id, detail, typ zlocinu, pomer, id zlocin, rodne cislo
INSERT INTO povolenie VALUES('1', 'nasilne vydane', 'pocestna lupez', '0,3', '1', '9262247712');
INSERT INTO povolenie VALUES('2', NULL, 'krades lizatka', '1', '2', '7403099863');

------ VYUZITE NA / id vybavnie, id zlocin
INSERT INTO vyuzite_na VALUES('102', '1');
INSERT INTO vyuzite_na VALUES('101', '2');

